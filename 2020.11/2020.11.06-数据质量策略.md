# 数据平台数据质量设计方案

## （一）数据质量检核维度介绍

**一个评估规则维度提供一种测量与管理信息和数据的方式。**区分规则维度有助于：

- 将维度与业务需求相匹配，并且划分评估的先后顺序；
- 了解从每一维度的评估中能够/不能够得到什么；
- 在时间和资源有限的情况下，更好地定义和管理项目计划中的行动顺序。

**数据质量检核主要分为以下规则维度：**

- **完整性（Completeness）：**用来描述信息的完整程度。
- **唯一性（Uniqueness）：**用来描述数据是否存在重复记录，没有实体多余出现一次。
- **有效性（Validity）：**用来描述模型或数据是否满足用户定义的条件。通常从命名、数据类型、长度、值域、取值范围、内容规范等方面进行约束。
- **一致性（Consistency）：**用来描述同一信息主体在不同的数据集中信息属性是否相同，各实体、属性是否符合一致性约束关系。
- **准确性（Accuracy）：**用来描述数据是否与其对应的客观实体的特征相一致（需要一个确定的和可访问的权威参考源）。
- **及时性（Timeless）：**用来描述从业务发生到对应数据正确存储并可正常查看的时间间隔程度，也叫数据的延时时长，数据在及时性上应能尽可能贴合业务实际发生时点。
- **可信性（credibility）：**用来描述数据发生是否符合客观规律。

每一规则维度可能需要不同的度量方法、时机和流程。这就导致了完成检核评估所需要的时间、金钱和人力资源会呈现出差异。数据数据质量的提升不是一蹴而就的，在清楚了解评估每一维度所需工作的情况下，选择那些当前较为迫切的检核维度和规则，从易到难、由浅入深的逐步推动数据质量的全面管理与提升。规则维度的初步评估结果是确定基线，其余评估则作为继续检测和信息改进的一部分，作为业务操作流程的一部分。

## （二）完整性

**数据层面完整性维度大类下可细分为以下维度小类：**

- **非空约束：**描述检核对象是否存在数据值为空的情况。如客户开户时，客户名称是必填项，不能出现为空的情况。

### 1.非空约束

#### a.通过非空约束索引

非空约束比较容易理解，简单的讲就是字段不能为空，检查方式也比较容易，只需要设定需要检查的字段，通过sql查询列值不能为空即可。将为空的数据查询出来进行整改。

## （三）唯一性

**数据层面唯一性维度大类下可细分为以下维度小类：**

- **主键唯一性约束：**描述一个或多个检核对象作为主键时是否唯一；
- **实体唯一性约束：**描述同一客观实体在不同业务数据集中的信息，经整合后是唯一的。如证件类型+证件号码+姓名相同，则其客户编号应唯一。

### 1.主键唯一性约束

建立监管规则，选择内置模板以及字段，见图例 (以T_POLICY_HOLDER为例):[图2]

### 2.实体唯一性约束

//todo，缺少业务意义对唯一性，多表关联后检查

## （四）有效性

数据层面有效性维度大类下可细分为以下维度小类：

- **代码值域约束：**描述检核对象的代码值是否在对应的代码表内。如业务规则定义“性别”的取值应该是“1-未知的性别”、“2-男性”、“3-女性”、“4-未说明的性别”，如果出现“A”、“B”这样的取值，则认为“性别”的代码值域存在问题；
- **长度约束：**描述检核对象的长度是否满足长度约束。如“金融机构编码”在《人民银行金融机构编码规范》中规定长度为14位，如果出现非14位的值，则判定为不满足长度约束，不是一个有效的“金融机构编码”；
- **内容规范约束：**描述检核对象的值是否按照一定的要求和规范进行数据的录入与存储。如“存款账号”应仅含数字，如果出现字母或其他非法字符，则不是一个有效的“存款账号”，不满足内容规范约束；
- **取值范围约束：**描述检核对象的取值是否在预定义的范围内。如“授信额度”取值范围应大于等于0，如果出现小于0的情况，则超出了取值范围的约束，不是一个有效的“授信额度”；
- **标志取值约束：**描述检核对象的值是否满足标志的取值约束，值仅为1或0。如“附属卡标志”的取值只能是1或0，否则不是一个有效的标志。

### 1.代码值域约束

描述检核对象的值是否按照一定的要求和规范进行数据的录入与存储。
例1: 依业务规则性别只有 “0:男” ，”1:女”，则性别字段只应出现0或1。
例2: 货币代码 (CURCODE) 只应有 “RMB” 或是”USD”值
方案: 属于事后套用监管规则，套用模板使得此字段唯一值个数应当小于2。[图3]

### 2.长度约束

描述检核对象的长度是否满足长度约束。
例如金融机构编码(ORGID)在《人民银行金融机构编码规范》中规定长度为14位
方案: 属于事后套用监管规则，由于Dataworks 数值型比较仅支持与固定职比较，于自定义规则输入SQL: 数字段长度应当要等于14。

### 3.内容规范约束

描述检核对象的值是否按照一定的要求和规范进行数据的录入与存储。
例 1:保费(AMOUNT)应该是数字而非输入”ABC…”等文字型态。
方案: 属于事前规范，建表时DDL与购建任务时字段映像已经规范数据结构

例2: 保单号(POLNUM)只应含”ABC..”等字段，而不是”@#$”等乱符。
方案: 属于事后套用监管规则，由于Dataworks 数值型比较仅支持与固定职比较，于自定义规则输入SQL:属有乱符的字段数应当要等于零，否则报警。

### 4.取值范围约束

描述检核对象的取值是否在预定义的范围内。
例如: 保费金额(AMOUNT)不为负数。
方案: 属于事后套用监管规则[图4]，由于Dataworks 数值型比较仅支持与固定职比较，我们选用自定义规则写SQL: 数小于零的值有几个，且其值应要等于零. 

## （五）一致性

**数据层面一致性维度大类下可细分为以下维度小类：**

- **等值一致性依赖约束：描述检核对象之间数据取值的约束规则。**一个检核对象数据取值必须与另一个或多个检核对象在一定规则下相等。如“身份证号码”长度为18位，后9位应与“密码”一致；
- **存在一致性依赖约束：描述检核对象之间数据值存在关系的约束规则。**一个检核对象的数据值必须在另一个检核对象满足某一条件时存在。如“投保状态”为已投保，则“投保日期”不应为空；
- **逻辑一致性依赖约束：描述检核对象之间数据值逻辑关系的约束规则。**一个检核对象上的数据值必须与另一个检核对象的数据值满足某种逻辑关系（如大于、小于等）。如“投保开始时间”小于等于“投保结束时间”。

### 1.等值一致性依赖约束

### 2.存在一致性依赖约束

### 3.逻辑一致性依赖约束

## （六）准确性

**数据层面准确性维度大类下可细分为以下维度小类：**

**取值准确性约束：描述检核对象是否与其对应的客观实体的特征相一致。**
如投保人的性别代码为`0-女性`，虽然满足代码值域约束，但却不满足取值准确性约束，因为该人为男性，其性别代码应为`1-男性`；再如国际保函业务的手续费应录入为`国际担保手续费收入`，却录入成`国内担保手续费收入`。
准确性要求不仅数据的取值范围和内容规范满足有效性的要求，其值也是客观真实世界的数据。由此可见，有效的数据未必是准确的，反之成立。
准确性通常需要业务人员或其他当事人手工核查。有时无法访问数据所描述的实际对象，在这种情况下，要仔细选择能够用来替代权威参考源的参照物。

对待这种情况，dataworks中数据质量规则没办法直接统一处理，只能通过即使查询的方式对数据结果进行详细核查。下面时即时查询的入口：

![data_check](./images/datacheck0.png)

## （七）及时性

**及时性约束：描述检核数据能否及时反映其对应的实际业务的时点状态。**如系统中“贷款五级分类”的分类比实际中的延迟几天变化；再如理财业务在理财系统中是成功状态，但在核心系统中却因通信的原因而没有入账。
及时性由于多由系统、通信等原因而造成，通常需要业务人员或系统人员手工核查。因为目前数据同步距离实际业务发生原系统链路过长，在dataworks对数据及时性探查可以通过对业务落表字段及业务发生实际时间比较的方式来实现。比如：payment支付表，业务发生时支付单上传日期enabledate和informatica入表时间字段inserttime存在时间间隔过大的情况，可以通过自定义sql的方式去实现。

![data_check](./images/datacheck2.png)

## （八）可信性

**数据可信性约束：描述再数据同步中每日/月增量数据是否符合理论的经验值。**如保单数据的每日分区数据较前日一般有10%增长，突然数据增长变为200%，这种情况有可能时数据同步出现问题。
可信性要求数据的总量波动符合基本客观规律，一般通过对7，15，30日数据进行比较，如果出现差距较大则进行详细的问题探查。
Dataworks中支持对数据可信性直接配置，简单操作后即可生效：

![data_check](./images/datacheck1.png)
